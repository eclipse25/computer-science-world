## Keep-Alive와 Multiplexing

HTTP에서 네트워크 연결 성능을 최적화하는 기술이다.

<br>

### 1. Keep-Alive (연결 유지)

Keep-Alive는 HTTP의 기본 특성이 stateless(무상태) 이기 때문에, 요청이 끝날 때마다 TCP 연결이 닫히는 문제를 해결하기 위해 도입된 기술이다.  
기본적으로 HTTP/1.0에서는 각 요청마다 새로운 TCP 연결을 생성하고 종료하지만, Keep-Alive를 사용하면 하나의 TCP 연결을 여러 요청에서 재사용할 수 있다.  
이를 통해 네트워크 지연을 줄이고, 서버와 클라이언트 간의 성능을 최적화할 수 있다.  

<br>

#### 개념
- HTTP 1.0에서는 기본적으로 요청이 끝나면 TCP 연결이 닫힌다.
- HTTP 1.1부터는 `Connection: keep-alive`를 통해 한 번 연결을 맺고 여러 요청을 처리할 수 있도록 개선되었다.
- HTTP/1.1에서는 Keep-Alive가 기본적으로 활성화되어 있으며, 연결을 닫으려면 `Connection: close`를 명시적으로 설정해야 한다.
    - 클라이언트 측에서는 HTTP 요청 헤더에 `Connection: close`를 설정해서 비활성화할 수 있다.
    - 서버 측에서는 Nginx, Apache 같은 웹 서버나 FastAPI, Express 같은 백엔드 프레임워크에서 비활성화하도록 설정할 수 있다.
- TCP 연결을 유지한 채 여러 HTTP 요청을 보낼 수 있다.
- Keep-Alive를 사용한다고 해서 클라이언트의 상태를 기억하는 것은 아니다.

<br>

#### 장점
- TCP 핸드셰이크(3-way handshake) 비용을 감소시켜 지연 시간을 단축한다.
- 연결을 재사용하여 서버 부하를 줄일 수 있다.

#### 단점
- 클라이언트가 너무 많은 Keep-Alive 연결을 유지하면 서버 리소스를 많이 차지할 수 있다.
- HTTP/1.1에서는 요청이 직렬 처리되므로 병목 현상이 발생할 수 있다. 이 문제를 해결하는 것이 Multiplexing이다.

<br>

### 2. Multiplexing (다중화)

Multiplexing은 하나의 연결에서 동시에 여러 요청을 병렬로 처리하는 기술이다.

#### 개념
- HTTP/2부터 지원되는 기능으로, 하나의 TCP 연결에서 여러 요청을 병렬로 처리할 수 있다.
- 기존 HTTP/1.1의 단점(직렬 처리 → 하나의 요청이 끝나야 다음 요청을 처리할 수 있음)을 해결한다.

#### 작동 방식
- HTTP/2는 프레임 기반 프로토콜을 사용하여 요청을 작은 단위로 쪼개 전송한다.
- 하나의 TCP 연결에서 여러 요청을 동시에 보낼 수 있다.
- 특정 요청이 느려도 다른 요청에 영향을 주지 않는다. (HTTP/1.1의 Head-of-Line Blocking을 해결한다.)

#### 장점
- 병렬 처리를 통해 성능을 향상시킨다.
- 대역폭 활용을 최적화하여 요청과 응답을 스트림 단위로 처리한다.
- 압축 지원(HPACK)을 통해 헤더 크기를 줄여 네트워크 효율을 증가시킨다.

#### 단점
- HTTP/2는 단일 TCP 연결만 사용하므로, 패킷 손실이 발생하면 모든 요청이 영향을 받을 수 있다.
- 브라우저와 서버가 HTTP/2를 지원해야 한다.

<br>

### Keep-Alive vs Multiplexing 비교<br>

|  기능  | Keep-Alive | Multiplexing (HTTP/2) |
|--------|-----------|----------------------|
| 연결 방식 | 하나의 연결을 재사용한다. | 하나의 연결에서 다중 요청을 병렬로 처리한다. |
| 요청 처리 | 직렬 처리 (하나씩 순차 처리)한다. | 병렬 처리가 가능하다. |
| 성능 | TCP 연결 비용을 절감한다. | 더 높은 성능을 제공한다. (병렬 처리) |
| HTTP 버전 | HTTP/1.1, HTTP/2 | HTTP/2 이상 |
| 단점 | 직렬 처리로 인해 성능에 한계가 있다. | 단일 TCP 연결에서 패킷 손실 발생 시 영향이 있을 수 있다. |

<br>

### 정리
- Keep-Alive는 연결을 유지하여 불필요한 TCP 핸드셰이크 비용을 줄이는 방식이다. (HTTP/1.1)
- Multiplexing은 하나의 연결에서 여러 요청을 병렬로 처리하는 방식이다. (HTTP/2)
- HTTP/2의 Multiplexing은 Keep-Alive보다 더 발전된 개념으로, Keep-Alive가 "연결 유지"를 담당한다면 Multiplexing은 "최적의 연결 활용"을 담당한다고 볼 수 있다.

